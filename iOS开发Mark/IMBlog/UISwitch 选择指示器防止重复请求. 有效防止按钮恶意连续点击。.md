# UISwitch 选择指示器防止重复请求. 有效防止按钮恶意连续点击。

## 前言

最近在项目中遇到使用 UISwitch 来进行切换设置 用户消息通知, 隐私相关的开关信息, 类似微信的 **设置 -> 新消息通知**, 页面内有多个不同类型开关按钮。 由于产品原因有些内容需要我们保存到后台, 所以移动端这边需要请求后台, 将用户设置的信息发送到后台进行保存, 并没有任何难度。

## 版本迭代

刚开始第一版本的时候, 页面的右上角还有个保存的按钮, 我们可以在点击保存的时候, 才进行网络请求, 但是没过多久. 产品就过来啦。
**产品:** 就来找事了 -.-, 说我们考虑到用户习惯, 决定要简单修改了下设计, 很简单就原来基础上去掉个**保存**按钮而已了。
**攻城狮:** 尼玛啵................

## 思考

看了上面的发展过程描述在结合标题, 我想大家应该想到是出什么问题了, 去掉了保存按钮之后, 移动端如何何时去将信息提交到后台？

**无脑请求:** 一个页面内 少则 5 个 Switch, 多则上 10 个都有可能, 如果需要每次等用户点击完按钮切换状态之后就立刻发送请求, 不合理, 切由于每次发送的请求都是异步的, 无法保证最后一次点击提交的数据到后台那边, 或者返回给移动端的时候 顺序是跟用户点击相同的, 最终结果不仅大量消耗资源, 频繁发送无用数据, 还无法确保结果准确性！ 直接Pass

我们需要实现: 即不浪费资源, 重复发送多次无用请求, 又保证数据准确无误, 还可以防止用户恶意连续点击操作。

## 合理的解决思路

通过上面的分析, 主要针对 用户重复连续点击, 重复请求后台, 浪费资源, 还可能导致数据不正确的情况, 我借鉴了防止 按钮重复被多次点击的原理, 应用到这里来, 其实是基本是同理的, 只不过 UISwitch 的交互方式和 点击按钮有些小小的区别。

思路: 在 UISwitch 的点击方法执行里面,采用记录上一次点击时间, 与最后一次点击时间 计算一个时间间隔, 我默认 5S 内不管点击多少次, 都会将上一次执行任务取消掉, 只会执行提交最后一次的结果, 否则直接按正常流程走即可。

## 最后

>希望此篇文章对您有所帮助，如有不对的地方，希望大家能留言指出纠正。
>谢谢！！！！！
>学习的路上,与君共勉!!!    
>>本文原创作者:[Jersey](https://www.jianshu.com/u/9c6bbe968616). 欢迎转载，请注明出处和[本文链接](https://www.jianshu.com/p/730a0619c339)



