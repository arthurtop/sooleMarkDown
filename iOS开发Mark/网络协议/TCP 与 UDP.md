# TCP 与 UDP

## 简介

其都是传输层协议, 

* TCP 属于传输控制协议
* UDP 属于用户数据报协议

## UDP 特点

* 无连接
* 尽最大努力交付. 不可靠
* 面向报文, 既不合并, 也不拆分。 当其从应用层传输到传输层时, 对传输的报文(无论其大小)不会进行任何封装, 只会讲起与 UDP 头部进行封装即组成一个  UDP 数据报。 直接将其进行传输。

## UDP 功能

* 复用
* 分用
* 差错检测

## TCP (传输控制协议)特点

* 面向连接
* 可靠传输
* 面向字节流
* 流量控制
* 拥塞控制 

## TCP如何保证可靠

* 无差错
* 不丢失
* 不重复
* 按序到达
发送一个请求,等待请求确认回复,在发起下一个。 假如出现超时情况,  会有一种超时重传的机制来保证无差错, 服务端会有一个确认差错的机制。 确认丢失机制。 确认迟到报文

确认差错, 确认丢失, 确认超时, 丢弃超时。 确认迟到

## 面向字节流

TCP 有一个接受和发送的缓冲区, 可将每次发送的报文, 和接收起来的报文, 进行一个封装, 合并成一次。

比如客户端发送多个请求, 如果每个请求字节流比较小,  其会将其封装到缓冲区, 封装起来一并发送。 减少发送次数。 与 UDP 的面向报文 恰恰相反。

## 流量控制

* 滑动窗口协议: 从应用层发送到传输层的数据, 到TCP 的发送缓存中, 每个请求报文,都包含一个序列号, 序列号以递增的形式保存。 发送窗口实际上就是发送缓存中的一个更小的容器,  包含了  最后被确认的字节序号和最后发送的字节。
* 接收方具备动态调增发送窗口的大小, 来决定发送窗口还能容纳多少字节的报文。这样来进行一个流量控制。

![窗口协议](https://img.mukewang.com/szimg/5b07f47300010cb616000900.jpg)

## 拥塞控制
* 慢开始, 避拥塞
* 快恢复, 快重传
* ![](https://img.mukewang.com/szimg/5b07f7140001a8d716000900.jpg)

## 为什么三次握手

1. 当客户端第一次发送同步报文时超时时。
2. 实际上就是解决同步请求连接超时异常问题。

## 为什么四次挥手

由于其是一个双方建立, 释放时也应该是一个双向释放. 

一般 客户端发起一个断开连接时, 服务器回复一个确认断开连接同步包, 此时 客户端已经和 服务端断开了连接。
但是 服务器任然还是跟客户端保持连接的, 此时属于一种半关闭的状态. 为了解决由于 服务器这边之前收到的客户端请求还没有全部发送结束, 让服务器还可以进行相应的相应, 当服务器相应结束之后, 在发送一个断开请求包, 客户端回复断开确认. 即断开所有连接。




